# Правила карточек компаний

## 1. Общие принципы

Карточка компании — основной элемент каталога. Структура строго зафиксирована.

## 2. Структура карточки

### Обычная компания

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  ДОМЕН (без www, без https)                    ┌─────────────────┐ │
│  example.com                                   │ Перейти на сайт │ │
│                                                │ (с UTM-меткой)  │ │
│  📞 +7 (999) 123-45-67                         ├─────────────────┤ │
│                                                │   Позвонить     │ │
│  📍 Москва, ул. Примерная, 123                 └─────────────────┘ │
│  (если адреса нет — пустая строка)                                  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### StekloRoll и Artalico (приоритетные)

```
┌─────────────────────────────────────────────────────────────────────┐
│ ┌──────────┐                                                        │
│ │ РЕКОМЕНД │  ДОМЕН (без www, без https)                            │
│ │ ПРОИЗВОД │  stekloroll.ru                                         │
│ │ ИТЕЛЬ    │                                                        │
│ └──────────┘  📞 +7 (999) 123-45-67                                  │
│               📍 Москва, Киевское ш., БЦ Румянцево                  │
│                                                                     │
│                                                ┌─────────────────┐ │
│                                                │ Рассчитать цену │ │
│                                                │  (калькулятор)  │ │
│                                                ├─────────────────┤ │
│                                                │   Позвонить     │ │
│                                                └─────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

## 3. Поля карточки

### Домен
- **Источник:** `company.website`
- **Форматирование:**
  - Убрать `https://`
  - Убрать `www.`
  - Оставить только `domain.ru`
- **Fallback:** `company.slug`

### Телефон
- **Источник:** `company.phone`
- **Отображение:** Как есть из БД
- **Формат:** `+7 (XXX) XXX-XX-XX` или городской
- **Ссылка:** `tel:+79991234567` (только цифры)

### Адрес
- **Источник:** `company.address`
- **Отображение:** Полный текст адреса
- **Если пусто:** Пустая строка (не "null", не "-")

## 4. Кнопки

### "Перейти на сайт"
- **URL:** `https://domain.ru?utm_source=stroysales&utm_medium=referral&utm_campaign=catalog`
- **Target:** `_blank`
- **Rel:** `noopener noreferrer`

### "Позвонить"
- **URL:** `tel:+79991234567` (только цифры)
- **Условие:** Показывать если `company.phone` не пустой

### "Рассчитать цену"
- **Только для:** StekloRoll и Artalico
- **Действие:** Открыть модальное окно калькулятора

## 5. Бейджи

| Бейдж | Цвет | Текст | Кому |
|-------|------|-------|------|
| РЕКОМЕНДУЕМ | Оранжевый (#F97316) | Белый | StekloRoll |
| ПРОИЗВОДИТЕЛЬ | Синий (#3B82F6) | Белый | StekloRoll |
| ПРЕМИУМ | Синий (#3B82F6) | Белый | Artalico |

## 6. Рамка для приоритетных

- **StekloRoll и Artalico:** Оранжевая рамка `ring-2 ring-orange-400 ring-offset-2`
- **Остальные:** Без рамки

## 7. Приоритет сортировки

```typescript
// 1. StekloRoll — всегда первая
if (a.slug?.includes('stekloroll')) return -1;

// 2. Artalico — всегда вторая  
if (a.slug?.includes('artalico')) return 0;

// 3. Остальные — по кликам (desc)
return (b.clicks || 0) - (a.clicks || 0);
```

## 8. UTM-метки

```
utm_source=stroysales
utm_medium=referral
utm_campaign=catalog
```

## 9. Проверка перед деплоем

- [ ] Домен без www и https
- [ ] Телефон под доменом
- [ ] Адрес или пустая строка (не null)
- [ ] UTM-метка на кнопке
- [ ] StekloRoll первая с бейджами
- [ ] Artalico вторая с бейджами
- [ ] Остальные без бейджей и рамок
- [ ] "Рассчитать цену" только у StekloRoll/Artalico

## 10. ⚠️ Правило изменений

### При любом изменении карточки:

1. Прочитать этот файл (CARD_RULES.md)
2. **Сообщить пользователю:** "Я собираюсь изменить структуру карточки компании. Продолжить?"
3. Получить подтверждение
4. Только потом вносить изменения

### Что считается изменением структуры:

- [ ] Перемещение полей
- [ ] Изменение порядка кнопок
- [ ] Добавление/удаление бейджей
- [ ] Изменение цветов рамок
- [ ] Изменение текста кнопок
- [ ] Изменение логики сортировки

### Что НЕ считается изменением:

- [ ] Исправление багов (null-check)
- [ ] Изменение отступов
- [ ] Исправление цветов (без логики)
- [ ] Оптимизация производительности

### Форма предупреждения:

```
⚠️ ВНИМАНИЕ: Изменение структуры карточки

Я собираюсь изменить:
- [описание]

Это повлияет на:
- [что изменится]

Продолжить? (да/нет)
```
